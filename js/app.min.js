jQuery(function(a){var b="処理に時間がかかっています。しばらくしてからやり直してみて下さい";a("#card_label_color,#board_color,#board_new_color").spectrum({preferredFormat:"hex",showInput:true,showInitial:true,showPaletteOnly:true,palette:[["#ffffff","#cccccc","#999999","#666666","#333333","#000000"],["#f44336","#ff9800","#ffeb3b","#8bc34a","#4caf50","#03a9f4","#2196f3"]]});a(".sortable").sortable();a(document).on("sortstop",".sortable",function(){var d=[];a(".pannel").each(function(f){var e=a(this).find("h2").attr("data-id");if(e!==""){d.push(e)}});var c=JSON.stringify(d);exePost("panels","sort","",c,"").done(function(){}).fail(function(){alert(b)})});a(".panel-body").sortable({connectWith:".panel-body"});a(document).on("sortstop",".panel-body",function(){a(".pannel").each(function(e){var d=a(this).find("h2").attr("data-id");if(d!==""){var f=[];a("#panel_area .panel h2[data-id='"+d+"']").parent().parent().children(".panel-body").find(".card").each(function(h){var g=a(this).attr("cardid");if(g!==""){f.push(g)}});var c=JSON.stringify(f);exePost("cards","sort",d,c,"").done(function(){}).fail(function(){alert(b)})}})});exePost("boards","first","","","").done(function(d){if(d){var c=a.parseJSON(d);a("#board_title h1").html(c.title);a("#board_title").attr("data-id",c.id);a("body").css("background-color",c.board_color);a("input#board_title_text").val(c.title);a("input#board_color").val(c.board_color);a("input#board_color").spectrum({showSelectionPalette:true,preferredFormat:"hex",showInput:true,showInitial:true,showPaletteOnly:true,palette:[["#ffffff","#cccccc","#999999","#666666","#333333","#000000"],["#f44336","#ff9800","#ffeb3b","#8bc34a","#4caf50","#03a9f4","#2196f3"]]});getPanels(c.id)}}).fail(function(c){alert(b)});getBoardList();a(document).on("click","#board_all_list li",function(){var c=a(this).attr("data-board");getBoard(c)});a(document).on("click","#logout",function(){window.location.replace("logout.php")});a("#panel_add").on("click",function(d){var c=a(".pannel").length;if(c>7){alert("パネルを増やせるのは7個までです");return}a("#panel_area").append(a("#hidden .panel").html());a("#panel_area .panel-body").sortable({connectWith:".panel-body"});return false});a(document).on("click",".panel h2",function(){var c=a(this).attr("data-id");a("#panel-modal").attr("data-id",c);if(c==="new"){a("#panel-modal #panel_title_text").val("")}else{a("#panel-modal #panel_title_text").val(a(this).html())}a("#panel-modal").modal("show")});a(document).on("click","#panel-modal .modal-dialog .modal-footer button#save-panel-btn",function(){var e=a("#panel_title_text").val();var c=a("#panel-modal").attr("data-id");var d=a("#board_title").attr("data-id");if((typeof c==="undefined")||(c==="")){c="new"}exePost("panels","save",c,e,d).done(function(g){var f=a.parseJSON(g);if(c==="new"){a("#panel_area .panel").find("h2[data-id='new']").eq(0).html(f.title);a("#panel_area .panel").find("h2[data-id='new']").eq(0).attr("data-id",f.id)}else{a("#panel_area .panel h2[data-id='"+c+"']").attr("data-id",f.id);a("#panel_area .panel h2[data-id='"+c+"']").html(f.title)}a("#panel-modal").modal("hide")}).fail(function(f){alert(b)})});a(document).on("click","#panel-modal .modal-dialog .modal-footer button#delete-btn",function(){if(window.confirm("このパネルを削除します。よろしいですか？")){var c=a("#panel-modal").attr("data-id");exePost("panels","del",c,"","","","").done(function(){a("#panel_area .panel h2[data-id='"+c+"']").parent().parent().remove();a("#panel-modal").modal("hide")}).fail(function(){alert(b)})}});a(document).on("click","#board_title h1",function(){a("#board-modal").modal("show")});a(document).on("click","#board_add",function(){a("#board_new_title_text").val("");a("#board_new_color").val("#000");a("#board-add-modal").modal("show")});a(document).on("click","#board-modal #save-btn",function(){var d=a("#board_title_text").val();var c=a("#board_color").val();var e=a("#board_title").attr("data-id");exePost("boards","save",e,d,c).done(function(g){var f=a.parseJSON(g);a("#board_title h1").html(f.title);a("body").css("background-color",f.board_color);a("input#board_title_text").val(f.title);a("#board_title").attr("data-id",f.id);getBoardList();a("#board-modal").modal("hide")}).fail(function(f){alert(b)})});a(document).on("click","#board-add-modal #save-btn",function(){var d=a("#board_new_title_text").val();var c=a("#board_new_color").val();exePost("boards","save","new",d,c).done(function(f){var e=a.parseJSON(f);a("#board_title h1").html(e.title);a("body").css("background-color",e.board_color);a("input#board_title_text").val(e.title);a("#board_title").attr("data-id",e.id);a("#panel_area").html("");getBoardList();a("#board-add-modal").modal("hide")}).fail(function(e){alert(b)})});a(document).on("click","#board-modal #delete-btn",function(){if(window.confirm("このボードを削除します。よろしいですか？")){var c=a("#board_title").attr("data-id");exePost("boards","del",c,"","","","").done(function(){exePost("boards","first","","","").done(function(e){var d=a.parseJSON(e);a("#board_title h1").html(d.title);a("#board_title").attr("data-id",d.id);a("body").css("background-color",d.board_color);a("input#board_title_text").val(d.title);a("input#board_color").val(d.board_color);getPanels(d.id)}).fail(function(d){alert(b)});getBoardList();a("#board-modal").modal("hide")}).fail(function(){alert(b)})}})});function getBoardList(){$("#board_all_list").html("");exePost("boards","list","","","").done(function(b){var c=$.parseJSON(b);var a="<ul>";$.each(c,function(d,e){a+="<li class='list-group-item' data-board='"+e.id+"' style='background: 10px "+e.board_color+"'>"+e.title+"</li>"});a+="</ul>";$("#board_all_list").html(a)}).fail(function(a){alert(timeOutMsg)})}function getPanels(a){exePost("panels","list",a,"","").done(function(c){if(c!==false){var d=$.parseJSON(c);var b="";$.each(d,function(e,f){$("#panel_area").append($("#hidden .panel").html());$("#panel_area .panel:last-child h2").html(f.title);$("#panel_area .panel:last-child h2").attr("data-id",f.id);exePost("cards","list",f.id,"","").done(function(g){var h=$.parseJSON(g);var i="";$.each(h,function(j,k){i+="<div class='card panel panel-default' style='border-top: 12px solid "+k.label_color+"' label_color='"+k.label_color+"' cardId='"+k.id+"'>"+k.title+"</div>"});$("#panel_area .panel h2[data-id='"+f.id+"']").parent().parent().children(".panel-body").append(i);$("#panel_area .panel h2[data-id='"+f.id+"']").parent().parent().children(".panel-body").sortable({connectWith:".panel-body"})})})}}).fail(function(b){alert(timeOutMsg)});$(document).on("click",".panel-body .card",function(){$("#card_title_text").val($(this).html());$("#card-edit").attr("data-id",$(this).attr("cardId"));$("#card-edit").attr("card_panel_id",$(this).parent().parent().find(".panel-heading h2").attr("data-id"));$("#card_label_color").val($(this).attr("label_color"));$("#card-move-modal").attr("data-id",$(this).attr("cardId"));if($(this).attr("cardId")==="new"){$("#move-btn").hide();$("#delete-btn").hide();$("#card_title_text").val("");$("#contents").val("");$("#contents_view").html("");$("#card_label_color").val("#cccccc");$("#card_label_color").spectrum({showSelectionPalette:true,preferredFormat:"hex",showInput:true,showInitial:true,showPaletteOnly:true,palette:[["#ffffff","#cccccc","#999999","#666666","#333333","#000000"],["#f44336","#ff9800","#ffeb3b","#8bc34a","#4caf50","#03a9f4","#2196f3"]]})}else{$("#move-btn").show();$("#delete-btn").show();exePost("cards","find",$(this).attr("cardId"),"","","","").done(function(c){if(c){var b=$.parseJSON(c);$("#contents").val(b.contents);$("#contents_view").html(nl2br(b.contents)).linkify({target:"_blank"});$("#card_label_color").val(b.label_color);$("#card_label_color").spectrum({showSelectionPalette:true,preferredFormat:"hex",showInput:true,showInitial:true,showPaletteOnly:true,palette:[["#ffffff","#cccccc","#999999","#666666","#333333","#000000"],["#f44336","#ff9800","#ffeb3b","#8bc34a","#4caf50","#03a9f4","#2196f3"]]})}}).fail(function(b){alert(timeOutMsg)});$("#contents").css("display","none");$("#contents_view").css("display","block")}$("#card-edit").modal("show")});$(document).on("click","#contents_toggle",function(){$("#contents_view").toggle();$("#contents").toggle();if($("#contents_toggle").html()==="編集"){$("#contents_toggle").html("表示")}else{$("#contents_toggle").html("編集")}});$(document).on("click",".pannel .panel-footer .card_add",function(){$(this).parent().parent().children(".panel .panel-body").append($('<div class="card panel panel-default" label_color="" cardid="new">New</div>'))});$(document).on("click","#card-edit .modal-dialog .modal-footer button#save-btn",function(){var g=$("#card_title_text").val();var e=$("#card_label_color").val();var d=$("#contents").val();var b=$("#card-edit").attr("data-id");var f=$("#board_title").attr("data-id");var c=$("#card-edit").attr("card_panel_id");if((typeof b==="undefined")||(b==="")){b="new"}exePost("cards","save",b,g,c,e,d).done(function(i){var h=$.parseJSON(i);var j=h.label_color;if(j==null){j=""}if($("#panel_area .panel h2[data-id='"+c+"']").parent().parent().find(".panel-body .card[cardId='new']").length>0){$("#panel_area .panel h2[data-id='"+c+"']").parent().parent().find(".panel-body .card[cardId='new']:last-child").html(h.title);$("#panel_area .panel h2[data-id='"+c+"']").parent().parent().find(".panel-body .card[cardId='new']:last-child").attr("style","border-top: 12px solid "+j);$("#panel_area .panel h2[data-id='"+c+"']").parent().parent().find(".panel-body .card[cardId='new']:last-child").attr("cardID",h.id)}else{$(".card[cardId='"+h.id+"']").html(h.title);$(".card[cardId='"+h.id+"']").attr("style","border-top: 12px solid "+j)}$("#card_title_text").val("");$("#card_label_color").val("");$("#contents").val("");$("#card-edit").modal("hide")}).fail(function(h){alert(timeOutMsg)})});$(document).on("click","#card-edit .modal-dialog .modal-footer button#delete-btn",function(){if(window.confirm("このカードを削除します。よろしいですか？")){var b=$("#card-edit").attr("data-id");var c=$("#card-edit").attr("card_panel_id");exePost("cards","del",b,"","","","").done(function(){$("#panel_area .panel h2[data-id='"+c+"']").parent().parent().find(".panel-body .card[cardId='"+b+"']").remove();$("#card-edit").modal("hide")}).fail(function(){alert(timeOutMsg)})}});$(document).on("click","#card-edit .modal-dialog .modal-footer button#move-btn",function(){$("#card-move-modal").modal("show");$("#board_select").html("");$("#panel_select").html("");exePost("boards","list","","","").done(function(c){var d=$.parseJSON(c);var b="<option value=''>-</option>";$.each(d,function(e,f){b+="<option value='"+f.id+"'>"+f.title+"</option>"});$("#board_select").append(b)}).fail(function(b){alert(timeOutMsg)});$(document).on("change","#board_select",function(){exePost("panels","list",$(this).val(),"","").done(function(c){if(c!==false){var d=$.parseJSON(c);var b="";$.each(d,function(e,f){b+="<option value='"+f.id+"'>"+f.title+"</option>"})}$("#panel_select").html("");$("#panel_select").append(b)}).fail(function(b){alert(timeOutMsg)})});$(document).on("click","#card-move-modal .modal-dialog .modal-footer button#save-panel-btn",function(){var b=$("#board_select").val();var e=$("#panel_select").val();var d=$("#card-move-modal").attr("data-id");var c=$("input[name='q']:radio:checked").val();exePost("cards",c,d,e,"","","").done(function(){$("#panel_area").html("");exePost("boards","first","","","").done(function(f){if(f){$("#panel_area").html("");getBoard(b);$("#card-move-modal").modal("hide");$("#card-edit").modal("hide")}}).fail(function(f){alert(timeOutMsg)})}).fail(function(){alert(timeOutMsg)})})})}function getBoard(a){exePost("boards","find",a,"","").done(function(c){var b=$.parseJSON(c);$("#board_title h1").html(b.title);$("#board_title").attr("data-id",b.id);$("body").css("background-color",b.board_color);$("input#board_title_text").val(b.title);$("input#board_color").val(b.board_color);$("input#board_color").spectrum({showSelectionPalette:true,preferredFormat:"hex",showInput:true,showInitial:true,showPaletteOnly:true,palette:[["#ffffff","#cccccc","#999999","#666666","#333333","#000000"],["#f44336","#ff9800","#ffeb3b","#8bc34a","#4caf50","#03a9f4","#2196f3"]]});$("#panel_area").html("");getPanels(b.id)}).fail(function(b){alert("処理に時間がかかっています。しばらくしてからやり直してみて下さい")})}function exePost(f,c,g,e,b,a,d){return $.ajax({type:"POST",url:"pdo.php",dataType:"text",timeout:10000,data:{mode:f,action:c,id:g,label:a,title:e,contents:b,etc1:d}})}function nl2br(a){if(!a){}else{a=a.replace(/\r\n/g,"<br />");a=a.replace(/(\n|\r)/g,"<br />")}return a};